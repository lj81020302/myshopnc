<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<meta name="viewport" content="initial-scale=1,maximum-scale=1,minimum-scale=1" />
<title>发布商品</title>
<link rel="stylesheet" type="text/css" href="../../css/base.css">
<link rel="stylesheet" type="text/css" href="../../css/nctouch_member.css">
<link rel="stylesheet" type="text/css" href="../../css/nctouch_common.css">
<link rel="stylesheet" type="text/css" href="../../css/nctouch_seller.css">
</head>
<body> 

<header id="header">
  <div class="header-wrap">
    <div class="header-l"> <a href="javascript:history.go(-1)"> <i class="back"></i> </a> </div>
    <div class="header-title">
      <h1>发布商品</h1>
    </div>
    <div class="header-r"> <a id="header-nav" href="javascript:void(0);"><i class="save"></i></a> </div>
  </div>
</header>
<div class="nctouch-main-layout">
  <form>
    <div class="nctouch-inp-con">
      <ul class="form-box">
      	<li class="form-item">
          <h4>商品分类:</h4>
          <div class="input-box">
            <input name="area_info" type="text" class="inp" id="area_info" autocomplete="off" onchange="btn_check($('form'));" readonly/>
          </div>
        </li>
        <li class="form-item">
          <h4>商品名称:</h4>
          <div class="input-box">
            <input type="text" class="inp" name="g_name" id="g_name" autocomplete="off" oninput="writeClear($(this));"/>
            <span class="input-del"></span> </div>
        </li>
        <li class="form-item">
          <h4>商品价格:</h4>
          <div class="input-box">
            <input type="tel" class="inp"  name="g_price"  id="g_price" autocomplete="off" oninput="writeClear($(this));"/>
            <span class="input-del"></span> </div>
        </li> 
		 <li class="form-item">
          <h4>折扣:</h4>
          <div class="input-box">
            <input type="number" class="inp" name="g_discount" id="g_discount" autocomplete="off" oninput="writeClear($(this));"/>
            <span class="input-del"></span> </div>
        </li> 
        <li class="form-item">
          <h4>市场价:</h4>
          <div class="input-box">
            <input type="text" class="inp" name="g_marketprice" id="g_marketprice" readonly >
            <span class="input-del"></span> </div>
        </li> 
         
         
		<li class="form-item upload-item">
          <h4>商品主图:</h4>
          <div class="input-box">
            <div class="nctouch-upload"> 
            	<a href="javascript:void(0);" onclick="showActionSheet(this)">  
            	 <span></span>
               <p><i class="icon-upload"></i></p>
              </a>
              <input type="hidden" name="goods_image_main" id="goods_image_main" value="" /> 
            </div>
            
          </div>
        </li>



		<li class="form-item upload-item">
          <h4>商品图片:</h4>
          <div class="input-box">
            <div class="nctouch-upload"> 
            	<a href="javascript:void(0);" onclick="showActionSheet(this)">  
            	 <span></span>
               <p><i class="icon-upload"></i></p>
              </a>
              <input type="hidden" name="goods_image1" id="goods_image1" value="" />
            </div>
            <div class="nctouch-upload"> 
            	<a href="javascript:void(0);" onclick="showActionSheet(this)">  
            	 <span></span>
               <p><i class="icon-upload"></i></p>
              </a>
              <input type="hidden" name="goods_image2" id="goods_image2" value="" />
            </div>
            <div class="nctouch-upload"> 
            	<a href="javascript:void(0);" onclick="showActionSheet(this)">  
            	 <span></span>
               <p><i class="icon-upload"></i></p>
              </a>
              <input type="hidden" name="goods_image3" id="goods_image3" value="" />
            </div>
			<div class="nctouch-upload"> 
				     <a href="javascript:void(0);" onclick="showActionSheet(this)">  
            	 <span></span>
               <p><i class="icon-upload"></i></p>
              </a>
              <input type="hidden" name="goods_image4" id="goods_image4" value="" />
            </div>
			<div class="nctouch-upload"> 
				    <a href="javascript:void(0);" onclick="showActionSheet(this)">  
            	 <span></span>
               <p><i class="icon-upload"></i></p>
              </a>
              <input type="hidden" name="goods_image5" id="goods_image5" value="" />
            </div>
          </div>
        </li>

 
        
         <li class="form-item">
          <h4>商品库存:</h4>
          <div class="input-box">
            <input type="tel" class="inp" name="g_storage" id="g_storage" autocomplete="off" oninput="writeClear($(this));">
            <span class="input-del"></span> </div>
        </li>
         <li class="form-item">
          <h4>商家货号:</h4>
          <div class="input-box">
            <input type="tel" class="inp" name="g_serial" id="g_serial" autocomplete="off" oninput="writeClear($(this));">
            <span class="input-del"></span> </div>
         </li>
          <li class="form-item">
          <h4>物流费用:</h4>
          <div class="input-box">
            <input type="tel" class="inp" name="g_freight" id="g_freight" autocomplete="off" oninput="writeClear($(this));">
            <span class="input-del" ></span> </div>
         </li>
         <li class="form-item" style="font-size:0.5rem;" id="feeinfo">
         </li>
		  
		 <li class="form-item" style="height:3rem;">
          <h4>商品描述:</h4>
          <div class="input-box evaluation-inp-block">  
            <input type="text" class="textarea" name="g_body" id="g_body"  > 
            <span class="input-del"></span> </div>
        </li>
        
      </ul>
	  <ul id="goodstate">
	  <li style="font-size:0.6rem;padding-left:0.5rem;">商品状态：
	        <input type="radio" class="inp" name="g_state" value=1 >&nbsp;立即发布&nbsp;
            <input type="radio" class="inp" name="g_state" value=0 checked>&nbsp;放人仓库
			</li>
	  </ul>
      <div class="error-tips"></div>
      <div class="form-btn"><a class="btn" href="javascript:;">发布商品</a></div>
	   
    </div> 
 
  </form>
</div>
<footer id="footer" class="bottom"></footer>

<script type="text/javascript" src="../../js/zepto.min.js"></script> 
<script type="text/javascript" src="../../js/config.js"></script> 
<script type="text/javascript" src="../../js/common-seller.js"></script>  
<script type="text/javascript" src="../../js/simple-plugin.js"></script> 
<script type="text/javascript" src="../../js/tmpl/footer.js"></script>  
<script type="text/javascript" src="../../js/tmpl/store_goods_add.js"></script>
<script type="text/javascript">
 var server=ApiUrl + "/index.php?act=seller_goods&op=upload_goods_image&key="+getCookie("seller_key");
var files=[];
var sourseselect=null;
// 上传文件
function upload(){
	if(files.length<=0){
		plus.nativeUI.alert("没有添加上传文件！");
		return;
	}
	 
	var wt=plus.nativeUI.showWaiting("正在上传图片，请稍候...");
	var task=plus.uploader.createUpload(server,
		{method:"POST"},
		function(t,status){ //上传完成
			wt.close();
			files=[]; 
			if(status==200){  
				 $(sourseselect).find("div").remove();
				 var returnobj=JSON.parse(t.responseText);
				 $(sourseselect).find("span").after('<div class="pic-thumb"><img src="' + returnobj.datas.pic + '"/></div>');
				 $(sourseselect).next().val(returnobj.datas.file_name); 
				 
			}else{ 
				   
				 plus.nativeUI.alert("上传失败："+JSON.parse(t.responseText).datas.error);
				
			}
		}
	);
	//task.addData("key","HelloH5+");
	task.addData("key",getCookie("seller_key"));
	for(var i=0;i<files.length;i++){
		var f=files[i];
		task.addFile(f.path,{key:f.name});
	}
	//plus.nativeUI.alert(getCookie("seller_key"));
	task.start();
}
function showActionSheet(sobj){
	sourseselect=sobj;
	var bts=[{title:"从手机相册选取"},{title:"手机拍照",style:"destructive"}];
	plus.nativeUI.actionSheet({title:"选择图片",cancel:"取消",buttons:bts},
		function(e){ 
			if(e.index==1){
				appendByGallery();
			}else if(e.index==2){
				appendByCamera();
			}else{
				
			}
		}
	);
}
// 拍照添加文件
function appendByCamera(){
	plus.camera.getCamera().captureImage(function(p){
		 
		handeluppic(p);
	});	
}
// 从相册添加文件
function appendByGallery(){
	plus.gallery.pick(function(p){ 
		
	 handeluppic(p);
		}); 
} 
	
	function handeluppic(p){
		//根据图片大小判断是否压缩
		  var picsize=0;
		  var wz = plus.nativeUI.showWaiting( "正在识别处理图片..." );
		  plus.io.resolveLocalFileSystemURL( p, function( entry) {
			  entry.file( function(file){
						var fileReader = new plus.io.FileReader(); 
						fileReader.readAsText(file, 'utf-8');  
						picsize=Math.ceil(file.size/1024); 
						if(picsize>500){
						 plus.zip.compressImage({
								src:p,
								dst:"_doc/cm.jpg",
								quality:70,
								overwrite:true
							},
							function(i){ 
								 files.push({name:"goods_image",path:i.target});
								 wz.close();
			           upload(); 
							},function(e){ 
								alert("压缩图片失败: "+JSON.stringify(e));
							}); 
			    
					   }else{
					   	       files.push({name:"goods_image",path:p});
					   	       wz.close();
					           upload(); 
					   	
					   }
						} );
			}, function( e ) {
				alert( "读取录像文件错误："+e.message );
			} );
	}
	</script>
</body>
</html>
